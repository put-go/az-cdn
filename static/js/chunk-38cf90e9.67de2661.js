(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38cf90e9"],{"217a":function(t,e,a){"use strict";a("70b9")},"51a2":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ticket-container"},[a("div",{staticClass:"ticket-header"},[a("a-button",{directives:[{name:"wave",rawName:"v-wave"}],attrs:{type:"primary"},on:{click:function(e){return t.onAdd()}}},[a("svg-icon",{attrs:{name:"plus"}}),t._v(" "+t._s(t.$t("新建工单"))+" ")],1)],1),t.ticketData?a("a-table",{staticClass:"ticket-table data-table use-shadow",attrs:{"data-source":t.ticketData,pagination:!1,"row-key":"id","table-layout":"fixed",scroll:{x:970}}},[a("a-table-column",{key:"index",attrs:{"data-index":"index",title:"#",width:"60px"}}),a("a-table-column",{key:"subject",attrs:{"data-index":"subject",title:t.$t("主题"),width:"200px"}}),a("a-table-column",{key:"levelLabel",attrs:{"data-index":"levelLabel",title:t.$t("工单级别"),width:"100px"}}),a("a-table-column",{key:"statusLabel",attrs:{"data-index":"statusLabel",title:t.$t("工单状态"),width:"100px"},scopedSlots:t._u([{key:"customRender",fn:function(e,n){return a("div",{},[a("a-badge",{attrs:{status:n.status===t.States.HANDLING?"error":"processing"}}),t._v(" "+t._s(e)+" ")],1)}}],null,!1,2346779520)}),a("a-table-column",{key:"created_at",attrs:{"data-index":"created_at",title:t.$t("创建时间"),width:"170px"},scopedSlots:t._u([{key:"customRender",fn:function(e){return a("div",{},[t._v(" "+t._s(t._f("datetime")(e))+" ")])}}],null,!1,1867572093)}),a("a-table-column",{key:"updated_at",attrs:{"data-index":"updated_at",title:t.$t("最后回复"),width:"170px"},scopedSlots:t._u([{key:"customRender",fn:function(e){return a("div",{},[t._v(" "+t._s(t._f("datetime")(e))+" ")])}}],null,!1,1867572093)}),a("a-table-column",{attrs:{title:t.$t("操作"),align:"center",width:"170px"},scopedSlots:t._u([{key:"default",fn:function(e,n){return[a("span",[a("a-button",{attrs:{type:"link"},on:{click:function(e){return t.onView(n)}}},[t._v(t._s(t.$t("查看")))]),a("a-button",{attrs:{disabled:n.status===t.States.CLOSED,type:"link"},on:{click:function(e){return t.onClose(n)}}},[t._v(t._s(t.$t("关闭")))])],1)]}}],null,!1,1641100411)})],1):a("div",{staticClass:"spin-loading"},[a("a-spin",{attrs:{size:"large"}})],1),a("ticket-modal",{ref:"refModal",on:{change:t.getTicketData}}),a("ticket-chat",{ref:"refChat"})],1)},s=[],r=a("c7eb"),i=a("5530"),o=a("1da1"),l=(a("d81d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:t.$t("新建工单"),"confirm-loading":t.loading,"after-close":t.onClosed},on:{ok:t.onSubmit},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("a-spin",{attrs:{spinning:t.loading}},[a("a-form-model",{ref:"refForm",attrs:{model:t.formModel,rules:t.formRules},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[a("a-form-model-item",{attrs:{label:t.$t("主题"),prop:"subject"}},[a("a-input",{attrs:{size:"large","max-length":64,placeholder:t.$t("请输入工单问题"),"allow-clear":""},model:{value:t.formModel.subject,callback:function(e){t.$set(t.formModel,"subject",e)},expression:"formModel.subject"}})],1),a("a-form-model-item",{attrs:{label:t.$t("工单等级"),prop:"level"}},[a("a-select",{attrs:{size:"large",placeholder:t.$t("请选择工单等级")},model:{value:t.formModel.level,callback:function(e){t.$set(t.formModel,"level",e)},expression:"formModel.level"}},t._l(t.Levels.toArray(),(function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v(" "+t._s(e.label)+" ")])})),1)],1),a("a-form-model-item",{attrs:{label:t.$t("消息"),prop:"message"}},[a("a-input",{attrs:{type:"textarea",size:"large","max-length":256,rows:4,placeholder:t.$t("请描述你遇到的问题"),"allow-clear":""},model:{value:t.formModel.message,callback:function(e){t.$set(t.formModel,"message",e)},expression:"formModel.message"}})],1)],1)],1)],1)}),c=[],u=a("77fe"),d=a("12cb"),f=new u["a"]({LOW:[0,d["a"].t("低")],NORMAL:[1,d["a"].t("中")],HIGH:[2,d["a"].t("高")]}),m=new u["a"]({HANDLING:[0,d["a"].t("待回复")],CLOSED:[1,d["a"].t("已关闭")]}),v=a("54d7"),p=a("8c8a");function b(){return Object(p["a"])({url:v["l"]+"/api/v1/user/ticket/fetch",method:"get"})}function h(t){return Object(p["a"])({url:v["l"]+"/api/v1/user/ticket/fetch?id=".concat(t),method:"get"})}function g(t){return Object(p["a"])({url:v["l"]+"/api/v1/user/ticket/save",method:"post",params:t})}function w(t){return Object(p["a"])({url:v["l"]+"/api/v1/user/ticket/close?id=".concat(t),method:"post"})}function k(t){return Object(p["a"])({url:v["l"]+"/api/v1/user/ticket/reply",method:"post",params:t})}var y={name:"TicketModal",data:function(){return{visible:!1,loading:!1,formModel:{subject:"",level:f.LOW,message:""},formRules:{subject:[{required:!0,message:d["a"].t("请输入工单问题"),trigger:"blur"}],level:[{required:!0,message:d["a"].t("请选择工单等级"),trigger:"change"}],message:[{required:!0,message:d["a"].t("请描述你遇到的问题"),trigger:"blur"}]},Levels:f}},methods:{showModal:function(t){var e=this;return Object(o["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.visible=!0;case 1:case"end":return t.stop()}}),t)})))()},onSubmit:function(){var t=this,e=this.formModel,a=e.subject,n=e.level,s=e.message;window.conso1e.log(73),this.$refs.refForm.validate(function(){var e=Object(o["a"])(Object(r["a"])().mark((function e(i){var o;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!i){e.next=14;break}return t.loading=!0,e.prev=2,e.next=5,g({subject:a,level:n,message:s});case 5:o=e.sent,!0===o.data&&(t.$message.success(t.$t("工单已提交")),t.visible=!1,t.$emit("change")),e.next=11;break;case 9:e.prev=9,e.t0=e["catch"](2);case 11:t.loading=!1,e.next=15;break;case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}())},onClosed:function(){console.log(222),this.formModel.message="",this.formModel.subject="",this.formModel.level=f.LOW}}},_=y,x=a("2877"),C=Object(x["a"])(_,l,c,!1,null,null,null),j=C.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:t.$t("工单回复"),width:800,"after-close":t.onClosed,footer:!1},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("form",{staticClass:"ticket-chat",on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[a("div",{staticClass:"chat-tip"},[t._v(t._s(t.$t("X个回复",{count:t.replyCount})))]),a("a-divider",{staticClass:"chat-line"}),t.messages?a("div",{staticClass:"chat-items"},[t.messages.length>0?t._l(t.messages,(function(e){return a("div",{key:e.id,staticClass:"chat-item"},[e.is_me?[a("div",{staticClass:"right",staticStyle:{"text-align":"right","margin-right":"20px"}},[a("span",{staticClass:"time"},[t._v(t._s(t._f("datetime")(e.updated_at)))]),a("span",{staticClass:"name"},[t._v("You")]),a("p",{staticClass:"content"},[t._v(t._s(e.message))])]),a("a-avatar",{staticClass:"avatar"},[t._v("U")])]:[a("a-avatar",{staticClass:"avatar"},[a("svg-icon",{attrs:{name:"user"}})],1),a("div",{staticClass:"right",staticStyle:{"text-align":"left","margin-left":"20px"}},[a("span",{staticClass:"name"},[t._v("Administrator")]),a("span",{staticClass:"time"},[t._v(t._s(t._f("datetime")(e.updated_at)))]),a("p",{staticClass:"content"},[t._v(t._s(e.message))])])]],2)})):t._e()],2):a("div",{staticClass:"spin-loading"},[a("a-spin",{attrs:{size:"large"}})],1),a("div",{staticClass:"chat-reply"},[a("a-avatar",{staticClass:"avatar"},[t._v("U")]),a("a-input",{staticClass:"input",attrs:{type:"textarea",size:"large","max-length":256,rows:4,placeholder:t.$t("请描述你遇到的问题"),"allow-clear":""},model:{value:t.replyContent,callback:function(e){t.replyContent=e},expression:"replyContent"}})],1),a("div",{staticClass:"chat-button"},[a("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"n-button color-1",attrs:{type:"submit"}},[a("svg-icon",{attrs:{name:"pencil-simple-line"}}),t._v(" "+t._s(t.$t("回复"))+" ")],1)])],1)])},$=[],M=(a("4de4"),a("d3b7"),{name:"Chat",data:function(){return{rowId:"",visible:!1,messages:null,replyContent:"",replyCount:0}},methods:{showModal:function(t){this.visible=!0,this.rowId=t.id,this.getMessages()},getMessages:function(){var t=this,e=function(){var e=Object(o["a"])(Object(r["a"])().mark((function e(){var a,n;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,h(t.rowId);case 2:n=e.sent,t.messages=null!==(a=n.data.message)&&void 0!==a?a:[],t.replyCount=t.messages.filter((function(t){return!t.is_me})).length;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e(),clearInterval(this.timer),this.timer=setInterval((function(){e()}),1e4)},onSubmit:function(){var t=this;return Object(o["a"])(Object(r["a"])().mark((function e(){var a;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(window.conso1e.log(27),t.replyContent){e.next=3;break}return e.abrupt("return",t.$message.warning(t.$t("请输入内容")));case 3:return e.next=5,k({id:t.rowId,message:t.replyContent});case 5:a=e.sent,!0===a.data&&(t.$message.success(t.$t("回复成功")),t.getMessages());case 7:case"end":return e.stop()}}),e)})))()},onClosed:function(){this.messages=[],this.replyContent="",this.replyCount=0,clearInterval(this.timer)}}}),L=M,S=(a("9e11"),Object(x["a"])(L,O,$,!1,null,"6d502e2c",null)),D=S.exports,A={name:"Ticket",components:{TicketModal:j,TicketChat:D},data:function(){return{ticketData:null,States:m,Levels:f}},mounted:function(){this.getTicketData()},methods:{getTicketData:function(){var t=this;return Object(o["a"])(Object(r["a"])().mark((function e(){var a,n;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return window.conso1e.log(264),e.next=3,b();case 3:n=e.sent,t.ticketData=(null!==(a=n.data)&&void 0!==a?a:[]).map((function(t,e){return Object(i["a"])(Object(i["a"])({},t),{},{index:e+1,levelLabel:f.getLabel(t.level),statusLabel:m.getLabel(t.status)})}));case 5:case"end":return e.stop()}}),e)})))()},onAdd:function(){this.$refs.refModal.showModal()},onView:function(t){this.$refs.refChat.showModal(t)},onClose:function(t){var e=this;window.conso1e.log(28),this.$confirm({title:this.$t("注意"),content:this.$t("确定要关闭该工单吗？"),onOk:function(){var a=Object(o["a"])(Object(r["a"])().mark((function a(){var n;return Object(r["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,w(t.id);case 2:n=a.sent,!0===n.data&&(e.$message.success(e.$t("工单已关闭")),e.getTicketData());case 4:case"end":return a.stop()}}),a)})));function n(){return a.apply(this,arguments)}return n}()})}}},I=A,T=(a("217a"),Object(x["a"])(I,n,s,!1,null,"cd496bf6",null));e["default"]=T.exports},"70b9":function(t,e,a){},"77fe":function(t,e,a){"use strict";var n=a("d4ec"),s=a("bee2"),r=(a("d3b7"),a("159b"),a("b64b"),a("d81d"),a("7db0"),function(){function t(e){Object(n["a"])(this,t),this.defination=e,this.parseDefination()}return Object(s["a"])(t,[{key:"parseDefination",value:function(){var t=this;Object.keys(this.defination).forEach((function(e){t[e]=t.defination[e][0]}))}},{key:"toArray",value:function(){var t=this,e=Object.keys(this.defination).map((function(e){var a=t.defination[e];return{value:a[0],label:a[1]}}));return e}},{key:"getLabel",value:function(t){var e,a;return null!==(e=null===(a=this.toArray().find((function(e){return String(e.value)===String(t)})))||void 0===a?void 0:a.label)&&void 0!==e?e:""}}]),t}());e["a"]=r},"7db0":function(t,e,a){"use strict";var n=a("23e7"),s=a("b727").find,r=a("44d2"),i="find",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{find:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),r(i)},8081:function(t,e,a){},"9e11":function(t,e,a){"use strict";a("8081")},bee2:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));var n=a("a38e");function s(t,e){for(var a=0;a<e.length;a++){var s=e[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,Object(n["a"])(s.key),s)}}function r(t,e,a){return e&&s(t.prototype,e),a&&s(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}},d4ec:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("d9e2");function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},d81d:function(t,e,a){"use strict";var n=a("23e7"),s=a("b727").map,r=a("1dde"),i=r("map");n({target:"Array",proto:!0,forced:!i},{map:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);